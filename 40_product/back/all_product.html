<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>產品查詢</title>
    <link rel="stylesheet" href="../../css/bootstrap.min.css">
    <!-- 使用CDN引入bootstrap-icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- 後台header -->
    <link rel="stylesheet" href="../../css/back_header.css">
    <link rel="stylesheet" href="../../css/all_product.css">
    <!-- 字型 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=LXGW+WenKai+TC:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="../../js/jquery-3.7.1.js"></script>
    <script src="../../js/bootstrap.bundle.js"></script>
    <!-- React -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.26.0/babel.js"></script>
</head>
<body>
    <!-- Header -->
    <header id="navbar" class="sticky-top ">
        <div class="member nav_icon">
            <a href="#" id="logout_btn">登出</a>
        </div>
        <div class="row align-items-center container-xl">
            <div class="text-center col-xxl-3 col-xl-3 col-lg-12 col-md-12 col-ms-12 col-12">
                <a class="" href="../../00_index/back/index_back.html">
                    <img class="nav-logo m-2" src="../../img/LOGO.png" alt="">
                </a>
            </div>
            <div class="col-xxl-9 col-xl-9 col-lg-12 col-md-12 col-ms-12 col-12">
                <ul class="nav justify-content-center text-center">
                    <li class="col-3 mt-3 mb-3 dropdown">
                        <a href="" data-toggle="dropdown" class="dropdown-toggle" role="button" id="header_beauty"
                            data-bs-toggle="dropdown" aria-expanded="false">美容預約</a>
                        <ul class="dropdown-menu nav_drop" aria-labelledby="header_beauty">
                            <li><a href="../../20_beauty/back/beauty_back.html" class="dropdown-item" id="beauty1">美容預約表</a></li>
                        </ul>
                    </li>
                    <li class="col-3 mt-3 mb-3 dropdown">
                        <a href="" data-toggle="dropdown" class="dropdown-toggle" role="button" id="header_hotel"
                            data-bs-toggle="dropdown" aria-expanded="false">寵物住宿</a>
                        <ul class="dropdown-menu nav_drop" aria-labelledby="header_hotel">
                            <li><a href="../../30_hotel/back/order_back.html" class="dropdown-item" id="hotel1">旅館訂單</a></li>
                            <li><a href="../../30_hotel/back/hotel_today_back.html" class="dropdown-item" id="hotel2">當日住宿</a></li>
                        </ul>
                    </li>
                    <li class="col-3 mt-3 mb-3 dropdown">
                        <a href="" data-toggle="dropdown" class="dropdown-toggle" role="button" id="header_product"
                            data-bs-toggle="dropdown" aria-expanded="false">產品專區</a>
                        <ul class="dropdown-menu nav_drop" aria-labelledby="header_product">
                            <li><a href="http://localhost/happypet/happypet_front/40_product/back/main_info.html" class="dropdown-item" id="product1">產品主要內容</a></li>
                            <li><a href="http://localhost/happypet/happypet_front/40_product/back/detail_info.html" class="dropdown-item" id="product2">產品詳細資訊</a></li>
                            <li><a href="http://localhost/happypet/happypet_front/40_product/back/warehouse.html" class="dropdown-item" id="product3">產品入庫</a></li>
                            <li><a href="http://localhost/happypet/happypet_front/40_product/back/on_shelves.html" class="dropdown-item" id="product4">上架中產品</a></li>
                            <li><a href="http://localhost/happypet/happypet_front/40_product/back/remove_shelves.html" class="dropdown-item" id="product5">未上架產品</a></li>
                            <li><a href="http://localhost/happypet/happypet_front/40_product/back/all_product.html" class="dropdown-item" id="product6">產品查詢</a></li>
                        </ul>
                    </li>
                    <li class="col-3 mt-3 mb-3 dropdown">
                        <a href="" data-toggle="dropdown" class="dropdown-toggle" role="button"
                            id="header_product_order" data-bs-toggle="dropdown" aria-expanded="false">產品訂單</a>
                        <ul class="dropdown-menu nav_drop" aria-labelledby="header_product_order">
                            <li><a href="../../10_member/back/product_orders.html" class="dropdown-item" id="product_order1">產品訂單資訊</a></li>
                            <li><a href="../../10_member/back/member_orders.html" class="dropdown-item" id="product_order2">會員訂單紀錄</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </header>
    <!-- Header end -->
    <div id="root"></div>

    <script type="text/babel">
       
        let myReactRoot = ReactDOM.createRoot(document.getElementById("root"));
        function QueryArea({keyWordObj}) {
            let {keyWord,setKeyWord,queryKeyWord} = keyWordObj
            // console.log('我是函數',queryKeyWord)
            // console.log('我是keyWord',keyWord)
            return (
                <table className="table border table-striped align-middle ">
                    <tbody>
                        <tr className="queryProductName ">
                            <th scope="row" className="text-center">產品關鍵字查詢<i className="bi bi-arrow-clockwise ms-1" onClick={()=>{setKeyWord('')}}></i></th>
                            <td className="border  ">
                                <input className="w-75" type="text" name="productName" placeholder="請輸入關鍵字" value={keyWord} onChange={()=>{setKeyWord(event.target.value)}}/>{" "}
                                <i className="bi bi-search ms-1" onClick={()=>{queryKeyWord(keyWord)}}></i>
                            </td>
                        </tr>
                    </tbody>
                </table>
            );
        }
        function ShowResult({productObj}) {
            let {product, setProduct} = productObj
            console.log('result裡',product)
            return (
                <table className="table table-striped align-middle text-center">
                    <thead>
                        <tr >
                            <th scope="col">序列</th>
                            <th scope="col">料號</th>
                            <th scope="col">產品名稱</th>
                            <th scope="col">主要資訊</th>
                            <th scope="col">詳細資訊</th>
                        </tr>
                    </thead>
                    <tbody id="productTbody">
                        {
                        product.map(({ product_id, full_name },i)=>{
                            return(<tr key={i}>
                                    <td>{i + 1}</td>
                                    <td>{product_id}</td>
                                    <td>{full_name}</td>
                                    <td><a href={`http://localhost/happypet/happypet_front/40_product/back/main_info.html?mode=edit&id=${product_id.substr(0, 11)}`}>
                                        <i className="bi bi-pen"></i>
                                    </a></td>
                                    <td><a href={`http://localhost/happypet/happypet_front/40_product/back/detail_info.html?mode=edit&id=${product_id.substr(0, 11)}`}>
                                        <i class="bi bi-brush"></i>
                                    </a></td>
                                </tr>)
                            })
                        }
                                
                                
                    </tbody>
                </table>
                                // <td data-seriesID={product_id.substr(0,11)} className="text-center"><i class="bi bi-pencil-square" onClick={() => handleEdit(product_id.substr(0, 11))}></i></td>
            );
        }
        function SearchAllProductApp() {
            let [keyWord, setKeyWord] = React.useState('');
            let [product, setProduct] = React.useState([]);
            let searchResult = React.useRef()
            React.useEffect(()=>{
                queryKeyWord()
            },[])
            function queryKeyWord(keyWord = '') {
                // let productName = $('[name="productName"]').val();
                // console.log(productName);
                // fetch(`http://localhost/testpet/public/api/product_back/allproducts?productName=${keyWord}`,
                fetch(`http://localhost/happypet/happypet_back/public/api/product_back/allproducts?productName=${keyWord}`,
                    {
                        method: "get",
                    }
                )
                .then((response) => response.json())
                .then((allproducts) => {
                    console.log('allproducts',allproducts)
                    setProduct(allproducts) 
                    console.log('product',product)
                    
                });
            }
            return (
                <React.Fragment>
                    <div class="container">
                        <h2 className="m-0 py-3">產品查詢</h2>
                        <QueryArea keyWordObj={{keyWord,setKeyWord,queryKeyWord}}/>
                        <ShowResult productObj={{product, setProduct}}/>
                    </div>
                </React.Fragment>
            );
        }
        
        myReactRoot.render(<SearchAllProductApp />);
    </script>
</body>
</html>
